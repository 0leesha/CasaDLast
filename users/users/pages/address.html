<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Addresses</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../CSS/address.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div id="navbar"></div>
    <section class="page-hero">
        <div class="container">
            <div class="page-hero-content">
                <h1>My Addresses</h1>
            </div>
        </div>
    </section>
    
    <section class="addresses-container">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <!-- Add New Address Button -->
                    <a href="#" class="add-address-btn" id="addAddressBtn">
                        <div><i class="bi bi-plus-circle"></i></div>
                        <div>Add New Address</div>
                    </a>

                    <!-- Addresses will be displayed here -->
                    <div id="addressesList"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Add/Edit Address Modal -->
    <div class="modal fade" id="addressModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add New Address</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addressForm">
                        <input type="hidden" id="addressId">
                        
                        <div class="mb-3">
                            <label for="addressType" class="form-label">Address Type *</label>
                            <select class="form-select" id="addressType" required>
                                <option value="Home">Home</option>
                                <option value="Office">Office</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="fullName" class="form-label">Full Name *</label>
                            <input type="text" class="form-control" id="fullName" required>
                        </div>

                        <div class="mb-3">
                            <label for="addressLine" class="form-label">Address Line *</label>
                            <input type="text" class="form-control" id="addressLine" required>
                        </div>

                        <div class="mb-3">
                            <label for="area" class="form-label">Area *</label>
                            <input type="text" class="form-control" id="area" required>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="state" class="form-label">State *</label>
                                <input type="text" class="form-control" id="state" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="pincode" class="form-label">Pincode *</label>
                                <input type="text" class="form-control" id="pincode" pattern="[0-9]{6}" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="country" class="form-label">Country *</label>
                            <input type="text" class="form-control" id="country" value="India" required>
                        </div>

                        <div class="mb-3">
                            <label for="phone" class="form-label">Phone Number *</label>
                            <input type="tel" class="form-control" id="phone" pattern="[+][0-9]{2} [0-9]{5} [0-9]{5}" placeholder="+91 98765 43210" required>
                        </div>

                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="setDefault">
                            <label class="form-check-label" for="setDefault">
                                Set as default address
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary-custom" id="saveAddressBtn">Save Address</button>
                </div>
            </div>
        </div>
    </div>

    <div id="footer"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../JS/services/cart.service.js"></script>
    <script src="../JS/ui/cart.ui.js"></script>
    <script src="../JS/common.js"></script>
    <script src="../JS/index.js"></script>
    <script src="../JS/app.js"></script>
    <script>  
        let addresses = [
            {
                id: 1,
                type: 'Home',
                name: 'Sarah Johnson',
                addressLine: '123 Main Street, Apartment 4B',
                area: 'Satellite Area, Ahmedabad',
                state: 'Gujarat',
                pincode: '380015',
                country: 'India',
                phone: '+91 98765 43210',
                isDefault: true
            },
            {
                id: 2,
                type: 'Office',
                name: 'Sarah Johnson',
                addressLine: '456 Business Park, Tower B, Floor 5',
                area: 'SG Highway, Ahmedabad',
                state: 'Gujarat',
                pincode: '380054',
                country: 'India',
                phone: '+91 98765 43210',
                isDefault: false
            },
            {
                id: 3,
                type: 'Other',
                name: 'Sarah Johnson',
                addressLine: '789 Holiday Homes, Villa 12',
                area: 'Vastrapur, Ahmedabad',
                state: 'Gujarat',
                pincode: '380015',
                country: 'India',
                phone: '+91 98765 43210',
                isDefault: false
            }
        ];

        const modal = new bootstrap.Modal(document.getElementById('addressModal'));
        const addressForm = document.getElementById('addressForm');
        let editingId = null;

        // Get icon based on address type
        function getAddressIcon(type) {
            switch(type) {
                case 'Home': return 'bi-house-door';
                case 'Office': return 'bi-briefcase';
                default: return 'bi-geo-alt';
            }
        }

        // Render all addresses
        function renderAddresses() {
            const container = document.getElementById('addressesList');
            container.innerHTML = addresses.map(addr => `
                <div class="address-card ${addr.isDefault ? 'default' : ''}">
                    ${addr.isDefault ? '<span class="default-badge"><i class="bi bi-check-circle"></i> Default</span>' : ''}
                    <div class="address-type">
                        <i class="bi ${getAddressIcon(addr.type)}"></i>
                        ${addr.type}
                    </div>
                    <div class="address-details">
                        <strong>${addr.name}</strong><br>
                        ${addr.addressLine}<br>
                        ${addr.area}<br>
                        ${addr.state} - ${addr.pincode}<br>
                        ${addr.country}<br>
                        <br>
                        <strong>Phone:</strong> ${addr.phone}
                    </div>
                    <div class="address-actions">
                        ${!addr.isDefault ? `<button class="btn btn-custom btn-outline-custom" onclick="setDefault(${addr.id})">
                            <i class="bi bi-star"></i> Set as Default
                        </button>` : ''}
                        <button class="btn btn-custom btn-primary-custom" onclick="editAddress(${addr.id})">
                            <i class="bi bi-pencil"></i> Edit
                        </button>
                        <button class="btn btn-custom btn-danger-custom" onclick="deleteAddress(${addr.id})">
                            <i class="bi bi-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Open modal for adding new address
        document.getElementById('addAddressBtn').addEventListener('click', (e) => {
            e.preventDefault();
            editingId = null;
            document.getElementById('modalTitle').textContent = 'Add New Address';
            addressForm.reset();
            document.getElementById('country').value = 'India';
            modal.show();
        });

        // Edit address
        window.editAddress = function(id) {
            const address = addresses.find(a => a.id === id);
            if (!address) return;

            editingId = id;
            document.getElementById('modalTitle').textContent = 'Edit Address';
            document.getElementById('addressId').value = id;
            document.getElementById('addressType').value = address.type;
            document.getElementById('fullName').value = address.name;
            document.getElementById('addressLine').value = address.addressLine;
            document.getElementById('area').value = address.area;
            document.getElementById('state').value = address.state;
            document.getElementById('pincode').value = address.pincode;
            document.getElementById('country').value = address.country;
            document.getElementById('phone').value = address.phone;
            document.getElementById('setDefault').checked = address.isDefault;

            modal.show();
        };

        // Save address
        document.getElementById('saveAddressBtn').addEventListener('click', () => {
            if (!addressForm.checkValidity()) {
                addressForm.reportValidity();
                return;
            }

            const isDefault = document.getElementById('setDefault').checked;
            const newAddress = {
                id: editingId || Date.now(),
                type: document.getElementById('addressType').value,
                name: document.getElementById('fullName').value,
                addressLine: document.getElementById('addressLine').value,
                area: document.getElementById('area').value,
                state: document.getElementById('state').value,
                pincode: document.getElementById('pincode').value,
                country: document.getElementById('country').value,
                phone: document.getElementById('phone').value,
                isDefault: isDefault
            };

            if (editingId) {
                const index = addresses.findIndex(a => a.id === editingId);
                if (isDefault) {
                    addresses.forEach(a => a.isDefault = false);
                }
                addresses[index] = newAddress;
            } else {
                if (isDefault || addresses.length === 0) {
                    addresses.forEach(a => a.isDefault = false);
                    newAddress.isDefault = true;
                }
                addresses.push(newAddress);
            }

            renderAddresses();
            modal.hide();
            addressForm.reset();
        });

        // Set default address
        window.setDefault = function(id) {
            addresses.forEach(a => a.isDefault = (a.id === id));
            renderAddresses();
        };

        // Delete address
        window.deleteAddress = function(id) {
            if (confirm('Are you sure you want to delete this address?')) {
                const wasDefault = addresses.find(a => a.id === id)?.isDefault;
                addresses = addresses.filter(a => a.id !== id);
                
                if (wasDefault && addresses.length > 0) {
                    addresses[0].isDefault = true;
                }
                
                renderAddresses();
            }
        };

        // Initial render
        renderAddresses();
    </script>
</body>
</html>